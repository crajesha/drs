<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Siddesh.g.g - Clinical Consultation</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the new futuristic look (Deep Purple/Electric Blue) */
        body {
            font-family: 'Inter', sans-serif;
            /* Dark, immersive background */
            background-color: #0c0a09; /* Stone-900 equivalent / near black */
            /* New gradient: Deep Purple (Violet) and Electric Blue */
            background-image: radial-gradient(at 0% 100%, #5b21b6 0%, transparent 50%),
                              radial-gradient(at 100% 0%, #3b82f6 0%, transparent 50%);
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
            overflow: hidden; /* Prevent scroll on initial screen */
        }

        .neon-glow {
            /* Glowing effect using electric blue color */
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.7), 0 0 5px rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease-in-out;
        }
        
        .neon-glow:hover {
            box-shadow: 0 0 25px rgba(59, 130, 246, 1), 0 0 10px rgba(59, 130, 246, 0.5);
            transform: translateY(-2px);
        }

        .input-futuristic {
            background-color: #1f2937;
            border: 1px solid #374151;
            color: #d1d5db;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .input-futuristic:focus {
            outline: none;
            /* Focus color is now electric blue */
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px #3b82f6;
        }

        /* Full-screen circle for Dr. Siddesh intro */
        #splashScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #0c0a09;
            z-index: 50;
            opacity: 1;
            transition: opacity 1.5s ease-out;
        }

        .doctor-circle {
            width: 80vw;
            height: 80vw;
            max-width: 400px;
            max-height: 400px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            border: 4px solid #8b5cf6; /* Violet border */
            background: rgba(45, 20, 80, 0.5); /* Semi-transparent violet background */
            /* Add a subtle violet glow */
            box-shadow: 0 0 40px rgba(139, 92, 246, 0.9), 0 0 10px rgba(139, 92, 246, 0.4) inset;
        }

    </style>
</head>
<body class="p-0 m-0">

    <!-- 1. FULL-SCREEN SPLASH SCREEN (Dr. Siddesh.g.g in a circle) -->
    <section id="splashScreen">
        <div class="doctor-circle">
            <h1 class="text-3xl md:text-5xl font-extrabold text-white">
                <span class="text-violet-400">Dr.</span> Siddesh.g.g
            </h1>
            <p class="text-sm md:text-lg text-blue-300 tracking-wider uppercase mt-2">
                Clinical Consulting Interface
            </p>
            <button id="enterButton" 
                    class="mt-6 px-6 py-2 text-sm font-semibold rounded-full bg-blue-600 text-white 
                           hover:bg-blue-500 focus:outline-none focus:ring-4 focus:ring-blue-500 neon-glow"
                    style="--tw-shadow-color: #3b82f6;">
                Access Console
            </button>
        </div>
    </section>

    <!-- 2. MAIN BOOKING CONTENT (Hidden until transition) -->
    <div id="mainContent" class="hidden h-screen overflow-y-auto p-4 md:p-8 flex items-center justify-center">
        <!-- Card uses electric blue border and glow -->
        <div class="w-full max-w-lg bg-gray-800/80 backdrop-blur-md rounded-xl p-6 md:p-10 neon-glow border-t-2 border-l-2 border-blue-400/50 my-10">
            
            <!-- Header Section: Dr. Siddesh.g.g -->
            <header class="text-center mb-8">
                <h1 class="text-3xl md:text-5xl font-extrabold text-white mb-2">
                    <span class="text-violet-400">Dr.</span> Siddesh.g.g
                </h1>
                <p class="text-sm md:text-lg text-blue-300 tracking-wider uppercase">
                    Clinical Consultation & AI Triage
                </p>
                <!-- Separator uses blue color -->
                <div class="h-1 w-24 bg-blue-500 mx-auto mt-4 rounded-full"></div>
            </header>

            <!-- Appointment Form -->
            <main>
                <h2 class="text-xl md:text-2xl font-bold text-gray-100 mb-6">Secure Appointment Request</h2>
                
                <form id="bookingForm" class="space-y-6">
                    
                    <!-- Patient Name -->
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-300 mb-1">Full Name</label>
                        <input type="text" id="name" name="name" required
                               class="w-full p-3 rounded-lg input-futuristic placeholder-gray-500">
                    </div>

                    <!-- Patient Age -->
                    <div>
                        <label for="age" class="block text-sm font-medium text-gray-300 mb-1">Age (Years)</label>
                        <input type="number" id="age" name="age" required min="1" max="120"
                               class="w-full p-3 rounded-lg input-futuristic placeholder-gray-500">
                    </div>

                    <!-- Problem Description -->
                    <div>
                        <label for="problem" class="block text-sm font-medium text-gray-300 mb-1">Brief Description of Problem/Symptoms</label>
                        <textarea id="problem" name="problem" rows="4" required
                                  class="w-full p-3 rounded-lg input-futuristic placeholder-gray-500"
                                  placeholder="e.g., Persistent headache for 3 days, fever, and fatigue..."></textarea>
                    </div>
                    
                    <!-- Submit Button uses Violet/Purple colors -->
                    <button type="submit"
                            class="w-full py-3 px-4 rounded-lg text-lg font-semibold bg-violet-600 text-white 
                                   hover:bg-violet-500 focus:outline-none focus:ring-4 focus:ring-violet-500 
                                   neon-glow"
                            style="--tw-shadow-color: #8b5cf6;">
                        Transmit Consultation Data
                    </button>
                </form>
                
                <!-- Dynamic Message Area (using blue for success) -->
                <div id="messageArea" class="mt-6 p-4 rounded-lg text-center hidden transition duration-300">
                    <!-- Message content will be inserted here -->
                </div>

            </main>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- UI Elements and Transition Logic ---
        const splashScreen = document.getElementById('splashScreen');
        const mainContent = document.getElementById('mainContent');
        const enterButton = document.getElementById('enterButton');
        const bookingForm = document.getElementById('bookingForm');
        const messageArea = document.getElementById('messageArea');

        // Function to handle the splash screen fade-out
        function startTransition() {
            splashScreen.style.opacity = '0'; // Start fade out
            setTimeout(() => {
                splashScreen.classList.add('hidden'); // Hide splash screen
                mainContent.classList.remove('hidden'); // Show main content
                document.body.style.overflow = 'auto'; // Re-enable scrolling if content exceeds viewport
            }, 1500); // Matches the CSS transition duration
        }

        // Attach transition trigger to the button
        enterButton.addEventListener('click', startTransition);

        // --- Firebase Initialization and Data Submission ---

        // Set log level for debugging
        setLogLevel('debug'); 

        // Global Firebase variables are provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth, userId = null;

        // Function to safely display messages
        function displayMessage(text, isError = false) {
            messageArea.innerHTML = `<p class="font-semibold">${text}</p>`;
            messageArea.classList.remove('hidden');

            if (isError) {
                // Red for error
                messageArea.classList.remove('bg-blue-700/50', 'text-white', 'border-blue-400');
                messageArea.classList.add('bg-red-700/50', 'text-white', 'border-red-400', 'border');
            } else {
                // Blue for success
                messageArea.classList.remove('bg-red-700/50', 'text-white', 'border-red-400');
                messageArea.classList.add('bg-blue-700/50', 'text-white', 'border-blue-400', 'border');
            }

            // Hide the message after 5 seconds
            setTimeout(() => {
                messageArea.classList.add('hidden');
            }, 5000);
        }

        async function initializeFirebase() {
            if (!firebaseConfig) {
                console.error("Firebase configuration is missing.");
                displayMessage("System Error: Database connection details missing.", true);
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Authenticate the user 
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                userId = auth.currentUser.uid;
                console.log("Firebase initialized. User ID:", userId);

                // Attach the form listener once Firebase is ready
                bookingForm.addEventListener('submit', handleFormSubmission);

            } catch (error) {
                console.error("Error during Firebase initialization or authentication:", error);
                displayMessage(`System Error: Could not connect to the database.`, true);
            }
        }

        /**
         * Handles the form submission, saving data to a public Firestore collection.
         */
        async function handleFormSubmission(event) {
            event.preventDefault(); 
            
            if (!db) {
                displayMessage("Database connection is not ready. Please try refreshing.", true);
                return;
            }

            const name = document.getElementById('name').value.trim();
            const age = document.getElementById('age').value.trim();
            const problem = document.getElementById('problem').value.trim();

            if (!name || !age || !problem) {
                displayMessage("Please fill in all fields to request an appointment.", true);
                return;
            }

            const submitButton = bookingForm.querySelector('button[type="submit"]');
            const originalButtonText = submitButton.textContent;
            submitButton.textContent = 'Transmitting...';
            submitButton.disabled = true;

            const appointmentData = {
                name: name,
                age: parseInt(age, 10),
                problem: problem,
                submittedByPatientId: auth.currentUser.uid, 
                timestamp: new Date().toISOString(),
            };

            // Path: artifacts/{appId}/public/data/appointments - Public for anyone to submit
            const appointmentsCollectionRef = collection(db, 'artifacts', appId, 'public', 'data', 'appointments');

            try {
                const docRef = await addDoc(appointmentsCollectionRef, appointmentData);
                
                displayMessage(`Transmission Complete! Your request (ID: ${docRef.id}) has been logged for Dr. Siddesh.g.g's review.`);
                
                // Reset form
                bookingForm.reset();

            } catch (e) {
                console.error("Error adding document: ", e);
                displayMessage("Transmission failed. Please check your connection and try again.", true);
            } finally {
                submitButton.textContent = originalButtonText;
                submitButton.disabled = false;
            }
        }

        // Start the application
        initializeFirebase();
    </script>
</body>
</html>